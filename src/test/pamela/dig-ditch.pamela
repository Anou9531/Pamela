;; Copyright Â© 2016 Dynamic Object Language Labs Inc.
;;
;; This software is licensed under the terms of the
;; Apache License, Version 2.0 which can be found in
;; the file LICENSE at the root of this distribution.

;;; Acknowledgement and Disclaimer:
;;; This material is based upon work supported by the Army Contracting
;;; and DARPA under contract No. W911NF-15-C-0005.
;;; Any opinions, findings and conclusions or recommendations expressed
;;; in this material are those of the author(s) and do necessarily reflect the
;;; views of the Army Contracting Command and DARPA.

(defpclass bulldozer []
  :meta {:version "0.2.1"
         :doc "Bulldozer plant"}
  :methods [(defpmethod clear-ditch
              {:doc "Clear the path for a ditch"}
              [])])

(defpclass worker []
  :meta {:version "0.2.1"
         :doc "Worker plant"}
  :methods [(defpmethod shovel
              {:doc "Move earth"}
              [])
            (defpmethod trim
              {:doc "Fix the edges of the ditch"}
              [])
            ])

(defpclass dig-ditch [bulldozer worker1 worker2 worker3]
  :meta {:version "0.2.1"
         :doc "Example of multiple resources for ditch digging TPN"}
  :methods [(defpmethod dig
              {:doc "Dig a ditch"}
              []
              (sequence :bounds [100 200]
                (bulldozer$clear-ditch :bounds [30 60])
                (choose
                  (choice :cost 100.00 (worker1$shovel))
                  (choice :cost 150.00 (worker2$shovel))
                  (choice :cost 200.00 (worker3$shovel)))
                (parallel :bounds [10 10]
                  (worker1$trim)
                  (worker2$trim)
                  (worker3$trim))
                ))])

(defpclass dig-ditch-1001 []
  :meta {:version "0.2.1"
         :depends [[bulldozer "0.2.1"]
                   [worker "0.2.1"]
                   [dig-ditch "0.2.1"]]
         :doc "Example static resource assignment for digging a ditch"}
  :fields {:bulldozer (bulldozer :id "bulldozer-42")
           :worker1 (worker :id "Gerhard")
           :worker2 (worker :id "Kim")
           :worker3 (worker :id "Annika")
           :dig-ditch (pclass dig-ditch :bulldozer
                        :worker1 :worker2 :worker3
                        :id "ditch-1001")})
