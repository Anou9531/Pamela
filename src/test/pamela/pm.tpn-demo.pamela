;; Copyright Â© 2016 Dynamic Object Language Labs Inc.
;;
;; This software is licensed under the terms of the
;; Apache License, Version 2.0 which can be found in
;; the file LICENSE at the root of this distribution.

(defpclass plant []
  :meta {:version "0.2.0"
         :doc "The Plant API"}
  :methods [(defpmethod track-elephant
              {:doc "Track Elephant"
               :bounds [150 180]}
              [])
            (defpmethod watch-right-hemisphere
              {:doc "Prepare food"
               :bounds [10 20]}
              [])
            (defpmethod watch-left-hemisphere
              {:doc "Prepare water"}
              [])
            (defpmethod take-move-low-res-images
              {:doc "Use Archive"
               :bounds [0 3]}
              [])
            (defpmeth take-high-res-images
              {:doc "Robot photos"
               :bounds [0 3]}
              [])
            (defpmethod move-high-res-images
              {:doc "Prep for processing"
               :bounds [0 4]}
              [])
            (defpmethod take-medium-res-images
              {:doc "Manual photos"
               :bounds [0 3]}
              [])
            (defpmethod move-medium-res-images
              {:doc "Manual photos upload"
               :bounds [0 4]}
              [])
            (defpmethod picture-analysis-type-1
              {:doc "Picture Analysis Phase 1"
               :bounds [0 6]}
              [])
            (defpmethod picture-analysis-type-2-fast
              {:doc "Picture Analysis Phase 2: HiRes"
               :bounds [0 10]}
              [])
            (defpmethod picture-analysis-type-2-slow
              {:doc "Picture Analysis Phase 2: LowRes"
               :bounds [0 10]}
              [])
            (defpmethod picture-analysis-type-3
              {:doc "Picture Analysis Phase 3"
               :bounds [0 7]}
              [])
            (defpmethod picture-distribution
              {:doc "Picture Distribution"
               :bounds [0 5]}
              [])
            ])

(defpclass tpn [plant]
  :meta {:version "0.2.0"
         :doc "TPN Demo"}
  :methods [(defpmethod elephant
              {:doc "the tpn"}
              []
              (parallel
                (plant$track-elephant :bounds [160 170])
                (parallel
                  (parallel :bounds [20 25]
                    (plant$watch-right-hemisphere) ;; use default bounds
                    (plant$watch-left-hemisphere))
                  (sequence :bounds [123 456] ;; these bounds are just for testing!
                     (choose
                       (choice (sequence
                         (plant$take-high-res-images :bounds [0 3])
                         (plant$move-high-res-images :bounds [0 4])))
                       (choice (plant$take-move-low-res-images :bounds [0 3]))
                       (choice :bounds [78 90] ;; these bounds are just for testing!
                         (sequence
                           (plant$take-medium-res-images :bounds [0 3])
                           (plant$move-medium-res-images :bounds [0 4]))))
                     (parallel
                       (plant$picture-analysis-type-1 :bounds [0 6])
                       (choose
                         (choice (plant$picture-analysis-type-2-slow :bounds [0 10]))
                         (choice (plant$picture-analysis-type-2-fast :bounds [0 10])))
                       (plant$picture-analysis-type-3 :bounds [0 7]))
                     (plant$picture-distribution :bounds [0 5])))))])
